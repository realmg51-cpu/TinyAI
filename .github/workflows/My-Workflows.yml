name: Project Checks

on: [push, pull_request]

permissions:
  contents: write
  pull-requests: write

jobs:
  # --- VÃ™NG 1: KIá»‚M TRA Äá»ŠNH Dáº NG ---
  linting:
    name: ğŸ§¹ Lint & Auto-fix
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref || github.ref_name }}
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
      - run: dotnet format
      - uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "style: ğŸ¤– tá»± Ä‘á»™ng dá»n dáº¹p code"

  # --- VÃ™NG 2: KIá»‚M TRA Báº¢O Máº¬T ---
  security:
    name: ğŸ›¡ï¸ Security Scan
    needs: linting # Cháº¡y sau khi lint xong cho gá»n
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/dependency-review-action@v4

  # --- VÃ™NG 3: BUILD VÃ€ TEST ---
  build-test:
    name: ğŸ—ï¸ Build & Test
    needs: linting # Äáº£m báº£o code Ä‘áº¹p rá»“i má»›i phÃ­ cÃ´ng build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
          cache: true
      - run: dotnet restore
      - run: dotnet build --no-restore -c Release -p:TreatWarningsAsErrors=true
      - run: dotnet test --no-build -c Release
