name: ðŸ“‚ Local File Backup

on:
  push:
    branches: [ "main" ]
    paths:
      - 'asset/code/**'
      # TrÃ¡nh vÃ²ng láº·p vÃ´ táº­n: KhÃ´ng cháº¡y backup khi chÃ­nh thÆ° má»¥c Backup thay Ä‘á»•i
      - '!asset/code/Backup/**'

permissions:
  contents: write # Cáº§n quyá»n ghi Ä‘á»ƒ Push báº£n backup lÃªn Repo

jobs:
  create-backup:
    name: ðŸ’¾ Sync Backup Folder
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸšš Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Láº¥y toÃ n bá»™ lá»‹ch sá»­ Ä‘á»ƒ commit khÃ´ng bá»‹ lá»—i

      - name: ðŸ§¹ Clean and Sync Backup
        run: |
          # Táº¡o thÆ° má»¥c Backup náº¿u chÆ°a cÃ³
          mkdir -p asset/code/Backup/
          
          # Copy toÃ n bá»™ file .cs vÃ  .csproj vÃ o thÆ° má»¥c Backup
          # (Loáº¡i trá»« chÃ­nh thÆ° má»¥c Backup Ä‘á»ƒ trÃ¡nh lá»“ng nhau)
          cp asset/code/*.cs asset/code/Backup/ 2>/dev/null || true
          cp asset/code/*.csproj asset/code/Backup/ 2>/dev/null || true
          
      - name: ðŸš€ Commit & Push Backup
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          git add asset/code/Backup/
          
          # Chá»‰ commit náº¿u cÃ³ sá»± thay Ä‘á»•i
          if git diff --staged --quiet; then
            echo "No changes in code, skipping backup."
          else
            git commit -m "backup: ðŸ¤– tá»± Ä‘á»™ng sao lÆ°u code dá»± Ã¡n [$(date +'%Y-%m-%d %H:%M')]"
            git push
          fi
