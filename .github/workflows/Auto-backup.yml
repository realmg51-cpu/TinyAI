name: ğŸ“‚ Versioned Local Backup

on:
  push:
    branches: [ "main" ]
    paths:
      - 'asset/code/*.cs'
      - 'asset/code/*.csproj'

permissions:
  contents: write

jobs:
  create-versioned-backup:
    name: ğŸ’¾ Create Timed Backup Folder
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸšš Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ› ï¸ Generate Backup
        run: |
          # 1. Táº¡o tÃªn thÆ° má»¥c dá»±a trÃªn thá»i gian (VD: 2026-02-14_18-30)
          # Sá»­ dá»¥ng mÃºi giá» Viá»‡t Nam (UTC+7) cho thÃ¢n thiá»‡n
          TIMESTAMP=$(TZ='Asia/Ho_Chi_Minh' date +'%Y-%m-%d_%H-%M')
          BACKUP_PATH="asset/code/Backup/$TIMESTAMP"
          
          echo "Creating backup at $BACKUP_PATH"
          mkdir -p "$BACKUP_PATH"
          
          # 2. Copy file code vÃ o thÆ° má»¥c vá»«a táº¡o
          # Äá»•i Ä‘uÃ´i thÃ nh .bak Ä‘á»ƒ cÃ¡c bot khÃ¡c (Lint/Build) khÃ´ng quÃ©t nháº§m
          cp asset/code/main.cs "$BACKUP_PATH/main.cs.bak"
          cp asset/code/main.csproj "$BACKUP_PATH/main.csproj.bak"
          
          # 3. Ghi chÃº láº¡i commit SHA Ä‘á»ƒ biáº¿t báº£n backup nÃ y tá»« Ä‘Ã¢u ra
          echo "Backup from commit: ${{ github.sha }}" > "$BACKUP_PATH/info.txt"

      - name: ğŸš€ Commit & Push Backup Folder
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          git add asset/code/Backup/
          
          if git diff --staged --quiet; then
            echo "No changes to backup."
          else
            git commit -m "archive: ğŸ—„ï¸ New backup version [$(TZ='Asia/Ho_Chi_Minh' date +'%H:%M')]"
            git push
          fi
